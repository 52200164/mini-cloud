<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Students – MyMiniCloud</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { background:#f8fafc; }
    .card-hover:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 28px rgba(2,6,23,.12);
      transition:.18s;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <header class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="h3 mb-1">Student List (live API)</h1>
        <p class="text-muted mb-0">Dữ liệu từ backend Flask qua API Gateway (/api/student).</p>
      </div>
      <a href="/" class="btn btn-outline-primary">Quay lại Home</a>
    </header>

    <section class="card p-3 mb-3 card-hover">
      <h5 class="mb-3">Thêm sinh viên mới</h5>
      <div class="row g-2">
        <div class="col-md-4">
          <input id="name" class="form-control" placeholder="Họ tên">
        </div>
        <div class="col-md-4">
          <input id="major" class="form-control" placeholder="Ngành">
        </div>
        <div class="col-md-2">
          <input id="gpa" type="number" step="0.01" class="form-control" placeholder="GPA">
        </div>
        <div class="col-md-2 d-grid">
          <button id="btnAdd" class="btn btn-success">Thêm sinh viên</button>
        </div>
      </div>
    </section>

    <section class="card p-3">
      <div class="table-responsive">
        <table class="table table-striped" id="tb">
          <thead class="table-primary">
            <tr>
              <th>ID</th><th>Họ tên</th><th>Ngành</th><th>GPA</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <div id="msg" class="mt-3"></div>

    <footer class="mt-4">
      <small class="text-muted">Frontend tĩnh (Nginx) + Backend Flask + MariaDB trong hệ thống MyMiniCloud.</small>
    </footer>
  </div>

<script>
// GỌI CÙNG ORIGIN: http://localhost:8080 + /api/student
const API_BASE = '/api/student';

async function loadData(){
  try {
    const res = await fetch(API_BASE);
    if (!res.ok) throw new Error('Không lấy được dữ liệu (HTTP ' + res.status + ')');
    const data = await res.json();
    const tbody = document.querySelector('#tb tbody');
    tbody.innerHTML = '';
    (Array.isArray(data) ? data : data.value || data).forEach(s => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${s.id ?? ''}</td><td>${s.name ?? ''}</td><td>${s.major ?? ''}</td><td>${s.gpa ?? ''}</td>`;
      tbody.appendChild(tr);
    });
  } catch(e) {
    document.getElementById('msg').innerHTML =
      '<div class="alert alert-danger">Lỗi tải dữ liệu: ' + e.message + '</div>';
  }
}

async function addStudent(){
  const name = document.getElementById('name').value.trim();
  const major = document.getElementById('major').value.trim();
  const gpa = document.getElementById('gpa').value;
  if (!name || !major) { alert('Vui lòng nhập Họ tên và Ngành'); return; }

  const payload = { name, major, gpa: gpa ? parseFloat(gpa) : null };

  try {
    const res = await fetch(API_BASE, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    if (res.status === 201 || res.ok) {
      document.getElementById('msg').innerHTML =
        '<div class="alert alert-success">Đã thêm sinh viên mới.</div>';
      document.getElementById('name').value = '';
      document.getElementById('major').value = '';
      document.getElementById('gpa').value = '';
      loadData();
    } else {
      const t = await res.text();
      document.getElementById('msg').innerHTML =
        '<div class="alert alert-danger">Lỗi thêm: ' + t + '</div>';
    }
  } catch(e) {
    document.getElementById('msg').innerHTML =
      '<div class="alert alert-danger">Lỗi: ' + e.message + '</div>';
  }
}

document.getElementById('btnAdd').addEventListener('click', addStudent);
window.addEventListener('load', loadData);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>